<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POST XENO — Store</title>
  <meta name="description" content="POST XENO store." />
  <style>
    :root { --bg:#0a0a0a; --card:#141414; --muted:#9aa0a6; --text:#e8eaed; --border:#222; --accent:#fff; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
    a{color:inherit;text-decoration:none}
    header,footer{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:baseline;gap:10px}
    .brand h1{margin:0;font-size:20px;letter-spacing:.12em}
    nav{display:flex;gap:12px;flex-wrap:wrap}
    .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:12px;background:transparent}
    .wrap{max-width:1100px;padding:20px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
    @media (max-width:1100px){.grid{grid-template-columns:1fr 1fr 1fr}}
    @media (max-width:900px){.grid{grid-template-columns:1fr 1fr}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#151515,#101010);border:1px solid var(--border);border-radius:20px;padding:16px;display:flex;flex-direction:column;gap:14px}
    .title{font-weight:600;font-size:16px}
    .price{color:var(--accent);font-weight:700;font-size:18px}
    .desc{color:var(--muted);font-size:13px;line-height:1.5}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#ffffff10;color:var(--text);font-weight:600;cursor:pointer;transition:transform .06s}
    .btn:hover{transform:translateY(-1px)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    /* Placeholder image box */
    .ph{width:100%;height:220px;border-radius:16px;background:linear-gradient(180deg,#1b1b1b,#0f0f0f);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:#6b7280;font-size:12px;letter-spacing:.06em}
    /* Cart drawer */
    .cart-toggle{position:relative}
    .cart-count{position:absolute;top:-8px;right:-8px;background:#fff;color:#000;border-radius:999px;font-size:11px;padding:2px 6px}
    .drawer{position:fixed;top:0;right:0;height:100%;width:380px;max-width:92vw;background:#101010;border-left:1px solid var(--border);transform:translateX(100%);transition:transform .2s ease;z-index:30;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer header{padding:16px;border-bottom:1px solid var(--border)}
    .drawer main{padding:16px;overflow:auto;flex:1}
    .drawer footer{padding:16px;border-top:1px solid var(--border)}
    .cart-item{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border-bottom:1px solid var(--border);padding:10px 0}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:10px}
    .qty button{background:transparent;border:0;color:var(--text);padding:6px 10px;font-size:16px;cursor:pointer}
    .qty span{min-width:24px;text-align:center}
    .newsletter{margin-top:36px;border:1px solid var(--border);border-radius:16px;padding:16px;background:#111}
    input[type="email"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#0b0b0b;color:var(--text);margin:8px 0}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1>POST XENO</h1>
    </div>
    <nav>
      <a class="chip" href="./disclosure.html">特定商取引法に基づく表記</a>
      <a class="chip" href="mailto:postxenohelp@gmail.com">Contact</a>
      <button id="openCart" class="chip cart-toggle">Cart <span id="cartCount" class="cart-count" hidden>0</span></button>
    </nav>
  </header>

  <main class="wrap">
    <section class="grid" aria-label="Products">
      <!-- Product cards (use your own photos later by replacing the .ph divs with <img src="...">) -->
      <article class="card" data-name="POST XENO Belt Chain Accessory" data-pricejpy="5000" data-img="">
        <div class="ph">IMAGE COMING SOON</div>
        <div class="title">POST XENO Belt Chain Accessory</div>
        <div class="row">
          <div class="price">¥5,000</div>
          <button class="btn add">Add to cart</button>
        </div>
      </article>

      <article class="card" data-name="POST XENO Fur Jacket" data-pricejpy="30000" data-img="">
        <div class="ph">IMAGE COMING SOON</div>
        <div class="title">POST XENO Fur Jacket</div>
        <div class="row">
          <div class="price">¥30,000</div>
          <button class="btn add">Add to cart</button>
        </div>
      </article>

      <article class="card" data-name="POST XENO Fallen Angel Tee (Black)" data-pricejpy="8000" data-img="">
        <div class="ph">IMAGE COMING SOON</div>
        <div class="title">POST XENO Fallen Angel Tee (Black)</div>
        <div class="row">
          <div class="price">¥8,000</div>
          <button class="btn add">Add to cart</button>
        </div>
      </article>

      <article class="card" data-name="POST XENO Fallen Angel Tee (Grey)" data-pricejpy="8000" data-img="">
        <div class="ph">IMAGE COMING SOON</div>
        <div class="title">POST XENO Fallen Angel Tee (Grey)</div>
        <div class="row">
          <div class="price">¥8,000</div>
          <button class="btn add">Add to cart</button>
        </div>
      </article>
    </section>

<section class="newsletter">
  <h3 style="margin:0 0 10px 0; font-weight:600;">
    Sign up for early access to future drops, limited releases, and exclusive member-only offers.
  </h3>
  <!-- Replace the action URL with your Mailchimp/Buttondown URL -->
  <form id="newsletter" action="https://YOUR_DC.list-manage.com/subscribe/post?u=YOUR_U&id=YOUR_ID" method="post" target="_blank" novalidate>
    <label for="email" style="font-size:14px; color:#aaa;">Email address</label>
    <input type="email" name="EMAIL" id="email" placeholder="" required />
    <button class="btn" type="submit" style="width:100%; margin-top:8px;">Join the List</button>
  </form>
    </section>
  </main>

  <!-- Cart Drawer -->
<aside class="drawer" id="drawer" aria-hidden="true">
  <header style="display:flex;align-items:center;justify-content:space-between;">
    <strong>Cart</strong>
    <button id="closeCart" style="background:none;border:none;color:#aaa;font-size:20px;cursor:pointer;">×</button>
  </header>
    <main id="cartItems"></main>
    <footer>
      <div class="row" style="margin-bottom:10px;">
        <span class="small">Subtotal (approx):</span>
        <strong id="subtotal">¥0</strong>
      </div>
      <button id="checkout" class="btn" style="width:100%;">Checkout with Stripe</button>
      <div class="small" style="margin-top:8px;">Shipping & taxes (if any) calculated at checkout.</div>
    </footer>
  </aside>

 <script>
  // --- Cart state ---
  const cart = []; // items: { key, name, qty, priceJpy, img }
  const drawer = document.getElementById('drawer');
  const cartItemsEl = document.getElementById('cartItems');
  const subtotalEl = document.getElementById('subtotal');
  const cartCount = document.getElementById('cartCount');

  // Open/close
  function openCart(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); renderCart(); }
  function closeCart(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }
  document.getElementById('openCart').addEventListener('click', openCart);
  document.getElementById('closeCart').addEventListener('click', closeCart);
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeCart(); });

  // Add from product cards
  document.querySelectorAll('.card .add').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const card = e.target.closest('.card');
      // use data-price if present, otherwise fall back to data-name
      const key = card.dataset.price || card.dataset.name;
      const name = card.dataset.name;
      const priceJpy = parseInt(card.dataset.pricejpy,10);
      const img = card.dataset.img || '';

      const existing = cart.find(i => i.key === key);
      if (existing) existing.qty += 1;
      else cart.push({ key, name, qty: 1, priceJpy, img });

      openCart();
      renderCart();
    });
  });

  // Render cart
  function renderCart(){
    cartItemsEl.innerHTML = '';
    let subtotal = 0;

    cart.forEach(item => {
      subtotal += item.priceJpy * item.qty;
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <div style="width:56px;height:56px;border-radius:10px;background:#1b1b1b;border:1px solid #222"></div>
        <div>
          <div style="font-weight:600">${item.name}</div>
          <div class="small">¥${item.priceJpy.toLocaleString()} × ${item.qty}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;">
          <div class="qty">
            <button class="qty-btn" data-action="dec" data-key="${item.key}">−</button>
            <span>${item.qty}</span>
            <button class="qty-btn" data-action="inc" data-key="${item.key}">＋</button>
          </div>
          <button class="small remove-btn" data-action="remove" data-key="${item.key}" style="background:transparent;border:0;color:#bbb;cursor:pointer">Remove</button>
        </div>
      `;
      cartItemsEl.appendChild(row);
    });

    subtotalEl.textContent = '¥' + subtotal.toLocaleString();
    const count = cart.reduce((a,b)=>a+b.qty,0);
    if (count > 0){ cartCount.hidden = false; cartCount.textContent = count; } else { cartCount.hidden = true; }
  }

  // Event delegation for + / − / Remove (works for dynamically created rows)
  cartItemsEl.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-action]');
    if (!btn) return;
    const key = btn.dataset.key;
    const action = btn.dataset.action;
    const item = cart.find(i => i.key === key);
    if (!item) return;

    if (action === 'inc') item.qty += 1;
    if (action === 'dec') item.qty = Math.max(1, item.qty - 1);
    if (action === 'remove') {
      const idx = cart.findIndex(i => i.key === key);
      if (idx >= 0) cart.splice(idx,1);
    }
    renderCart();
  });

  // Checkout (inline price_data)
  document.getElementById('checkout').addEventListener('click', async () => {
    if (cart.length === 0) return alert('Cart is empty.');
    const items = cart.map(i => ({ name: i.name, unit_amount: i.priceJpy * 100, quantity: i.qty }));
    try {
      const res = await fetch('/api/checkout', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({ items })
      });
      const data = await res.json();
      if (data.url) window.location = data.url;
      else alert('Checkout error. Please try again.');
    } catch {
      alert('Network error. Please try again.');
    }
  });
</script>
</body>
</html>
